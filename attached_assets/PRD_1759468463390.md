# PRD: 네이버 블로그 스마트블록 순위 추적 시스템

## 📋 문서 정보
- **프로젝트명**: Naver Blog Smart Block Rank Tracker
- **버전**: 1.0.0
- **작성일**: 2025-10-02
- **작성자**: 키워드솔루션 개발팀
- **승인자**: 연태경 대표이사

---

## 🎯 1. 프로젝트 개요

### 1.1 배경
네이버 통합검색에서 블로그 콘텐츠가 상단 "스마트블록"(주제어 영역)에 노출되는 것이 트래픽과 비즈니스에 결정적입니다. 그러나 현재는:
- 수동으로 매일 검색해서 순위를 확인해야 함
- 순위 변동이나 이탈을 즉시 알 수 없음
- 언제 재발행해야 하는지 판단 근거 부족

### 1.2 목표
**블로그 URL + 키워드 조합의 네이버 통합검색 스마트블록 내 순위를 자동으로 측정하고, 이탈 시 알림하여 적시 재발행 의사결정을 지원**

### 1.3 핵심 가치 제안
- ✅ **자동화**: 수동 순위 확인 제거 (키워드 100개 → 하루 3시간 절감)
- ✅ **실시간 알림**: 순위 이탈/급변 시 즉시 Slack/SMS 통지
- ✅ **데이터 기반**: 30일 추세 분석으로 재발행 타이밍 최적화
- ✅ **확장성**: 키워드 10개 → 1,000개까지 무리 없이 확장

---

## 👥 2. 주요 이해관계자

| 역할 | 이름/부서 | 책임 범위 |
|------|----------|----------|
| Product Owner | 연태경 대표 | 최종 승인, 요구사항 |
| 개발팀 | 개발팀 | 시스템 구현 |
| 운영팀 | 마케팅팀 | 일일 모니터링, 재발행 실행 |

---

## 🎯 3. 핵심 요구사항

### 3.1 기능 요구사항

#### FR-1: 키워드 & URL 등록 관리
**우선순위**: P0 (필수)

**설명**: 사용자가 추적할 키워드와 블로그 URL을 등록/수정/삭제할 수 있어야 함

**인수 조건**:
- [ ] 키워드 + URL 쌍을 CSV 파일로 일괄 업로드 가능
- [ ] 웹 UI에서 개별 등록/수정/삭제 가능
- [ ] 중복 등록 방지 (동일 키워드+URL 조합)
- [ ] 활성/비활성 상태 토글 가능

**예시**:
```
키워드: "호텔침대"
URL: "https://blog.naver.com/myshop/987654"
상태: 활성
```

---

#### FR-2: 스마트블록 순위 자동 측정
**우선순위**: P0 (필수)

**설명**: 등록된 키워드+URL의 네이버 통합검색 스마트블록 내 순위를 매일 자동 측정

**순위 판정 규칙**:
```
1위, 2위, 3위: 스마트블록 내 정확한 위치
0위: 다음 중 하나
  - 스마트블록 자체가 없음 (block_missing)
  - 스마트블록은 있으나 해당 URL 없음 (not_in_block)
  - 4위 이하 (이탈로 간주)
```

**측정 프로세스**:
1. 네이버 통합검색 HTML 수급 (SerpAPI)
2. 스마트블록 섹션 탐지
   - 헤딩 키워드: "인기글", "블로그 인기", "주제어" 등
   - 카드 구조: 썸네일 + 제목 + 블로그명 × 3개
   - 도메인 패턴: blog.naver.com, tistory.com 등
3. 상위 3개 링크 추출
4. URL 정규화 후 매칭
5. 순위 산출 (1~3 또는 0)

**인수 조건**:
- [ ] 매일 오전 3시 자동 실행
- [ ] 키워드당 측정 시간 < 5초
- [ ] 측정 성공률 > 95%
- [ ] 스마트블록 탐지 정확도 > 90%

---

#### FR-3: 보조 지표 수집
**우선순위**: P1 (중요)

**설명**: 스마트블록 순위 외 추가 지표 수집

**지표 종류**:
1. **블로그 탭 순위** (Naver Search API)
   - 블로그 전용 탭에서의 순위 (1~20위)
   - 스마트블록 없을 때 추세 판단 용도

2. **검색량 추이** (Naver DataLab API)
   - 최근 30일 검색 지수
   - 재발행 타이밍 판단 근거

**인수 조건**:
- [ ] 블로그 탭 순위: 매일 측정
- [ ] 검색량 추이: 주 1회 갱신
- [ ] API 할당량 초과 시 graceful degradation

---

#### FR-4: 실시간 알림
**우선순위**: P0 (필수)

**설명**: 순위 변동 시 즉시 알림 발송

**알림 조건**:

| 조건 | 알림 채널 | 예시 |
|------|----------|------|
| 순위 이탈 (0위) | Slack + SMS | 🚨 "호텔침대" 순위 이탈 (3위→0위) |
| 연속 이탈 3일 | Slack + Email | ⚠️ "호텔침대" 3일 연속 이탈 → 재발행 권고 |
| 급등 (2단계↑) | Slack | 📈 "호텔침대" 순위 급등 (3위→1위) |
| 급락 (2단계↓) | Slack | 📉 "호텔침대" 순위 급락 (1위→3위) |

**알림 내용**:
```
🚨 순위 이탈 알림

키워드: 호텔침대
URL: blog.naver.com/myshop/987654

변동: 3위 → 0위
사유: 스마트블록 내 미발견 (not_in_block)
이전 측정: 2025-10-01 03:00 (3위)
현재 측정: 2025-10-02 03:00 (0위)

블로그 탭 순위: 7위
검색량 추세: 상승 중 📈

[SERP 스냅샷 보기] [재발행 가이드]
```

**인수 조건**:
- [ ] 알림 발송 시간 < 1분 (측정 완료 후)
- [ ] Slack 웹훅 연동
- [ ] SMS 게이트웨이 연동 (선택)
- [ ] 알림 내역 DB 저장

---

#### FR-5: 대시보드
**우선순위**: P1 (중요)

**설명**: 순위 추세와 현황을 시각적으로 확인

**화면 구성**:

**1) 목록 화면**
```
┌────────────────────────────────────────────────────────┐
│  키워드    현재 순위   7일 추세   블로그탭   상태      │
├────────────────────────────────────────────────────────┤
│ 호텔침대      3위      ▲ ━ ▼     7위      정상 ✅     │
│ 5성급호텔     0위      ▼ ▼ ▼     15위     이탈 🚨     │
│ 침대추천      1위      ━ ▲ ▲     2위      급등 📈     │
└────────────────────────────────────────────────────────┘

필터: [전체] [이탈만] [연속이탈] [급변]
정렬: [순위순] [변동폭] [검색량]
```

**2) 상세 화면**
- 30일 순위 추세 그래프
- 스마트블록 vs 블로그 탭 순위 비교
- 검색량 추이 (DataLab)
- SERP 스냅샷 (HTML + 스크린샷)
- 측정 이력 테이블

**인수 조건**:
- [ ] 반응형 웹 (모바일 지원)
- [ ] 페이지 로딩 < 2초
- [ ] 실시간 데이터 (10분 캐시)
- [ ] CSV/Excel 내보내기

---

### 3.2 비기능 요구사항

#### NFR-1: 성능
- 키워드당 측정 시간 < 5초
- 100개 키워드 동시 측정 < 10분
- 대시보드 페이지 로딩 < 2초
- API 응답 시간 < 500ms

#### NFR-2: 안정성
- 시스템 가용성 > 99% (월 7.2시간 다운타임 허용)
- 측정 성공률 > 95%
- 자동 재시도 (최대 3회, 지수 백오프)
- 장애 시 이메일 알림

#### NFR-3: 확장성
- 키워드 100개 → 1,000개 확장 가능
- 수평 확장 (서버 추가) 지원
- 측정 주기 조정 가능 (1회/일 → 2회/일)

#### NFR-4: 보안
- API 키/시크릿 암호화 저장 (AWS Secrets Manager)
- HTTPS 통신
- 역할 기반 접근 제어 (RBAC)
- 민감 로그 마스킹

#### NFR-5: 유지보수성
- 레이아웃 변경 자동 탐지 알림
- 파싱 로직 모듈화 (쉬운 수정)
- 상세 로깅 (디버깅 용이)
- 스냅샷 보관 (HTML + 스크린샷)

---

## 🏗️ 4. 시스템 아키텍처

### 4.1 고수준 아키텍처

```
┌─────────────────────────────────────────────────────┐
│                   사용자 인터페이스                   │
│            웹 대시보드 + Slack + SMS                 │
└─────────────────────────────────────────────────────┘
                        ↓ ↑
┌─────────────────────────────────────────────────────┐
│                   백엔드 API 서버                     │
│            Node.js (Express) + TypeScript            │
│  - 키워드 관리 API                                   │
│  - 측정 작업 스케줄링                                │
│  - 알림 발송                                         │
│  - 대시보드 데이터 제공                              │
└─────────────────────────────────────────────────────┘
                        ↓ ↑
┌─────────────────────────────────────────────────────┐
│                   작업 큐 시스템                      │
│              BullMQ + Redis                          │
│  - 측정 작업 큐                                      │
│  - 재시도 & 백오프                                   │
│  - 스케줄링 (cron)                                   │
└─────────────────────────────────────────────────────┘
                        ↓
┌───────────────────┬─────────────────┬───────────────┐
│   SerpAPI         │  Naver APIs     │  파싱 엔진     │
│   (SERP HTML)     │  (보조 지표)    │  (핵심 로직)   │
├───────────────────┼─────────────────┼───────────────┤
│ • Naver 검색 HTML │ • Search API    │ • 섹션 탐지   │
│ • $50~250/월      │   (블로그 탭)   │ • URL 정규화  │
│ • 5,000~30,000회  │ • DataLab API   │ • 순위 산출   │
│                   │   (검색량)      │ • 스냅샷 저장 │
└───────────────────┴─────────────────┴───────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│                   데이터베이스                        │
│                  PostgreSQL                          │
│  - keywords (키워드+URL)                             │
│  - measurements (측정 결과)                          │
│  - alerts (알림 이력)                                │
│  - snapshots (SERP HTML/스크린샷)                    │
└─────────────────────────────────────────────────────┘
```

### 4.2 데이터 모델

```sql
-- 추적 대상
CREATE TABLE keywords (
  id SERIAL PRIMARY KEY,
  keyword TEXT NOT NULL,
  target_url TEXT NOT NULL,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),
  UNIQUE(keyword, target_url)
);

-- 측정 결과
CREATE TABLE measurements (
  id BIGSERIAL PRIMARY KEY,
  keyword_id INT REFERENCES keywords(id),
  measured_at TIMESTAMPTZ NOT NULL,

  -- 스마트블록 순위
  rank_smallblock INT,              -- 1~3 or NULL
  smallblock_status TEXT,           -- 'ok' | 'block_missing' | 'not_in_block'

  -- 보조 지표
  blog_tab_rank INT,                -- 1~20 or NULL
  search_volume_avg DECIMAL,        -- DataLab 평균 검색지수

  -- 메타데이터
  device TEXT DEFAULT 'desktop',
  vendor TEXT DEFAULT 'serpapi',
  serp_html_hash TEXT,
  serp_snapshot_path TEXT,
  error_message TEXT,

  created_at TIMESTAMPTZ DEFAULT now()
);

-- 알림
CREATE TABLE alerts (
  id BIGSERIAL PRIMARY KEY,
  keyword_id INT REFERENCES keywords(id),
  triggered_at TIMESTAMPTZ NOT NULL,
  alert_type TEXT,                  -- 'rank_drop' | 'consecutive_drop' | 'rank_up'
  reason TEXT,
  prev_rank INT,
  curr_rank INT,
  channel TEXT,                      -- 'slack' | 'sms' | 'email'
  is_sent BOOLEAN DEFAULT false,
  sent_at TIMESTAMPTZ
);

-- 인덱스
CREATE INDEX idx_measurements_keyword_date
  ON measurements(keyword_id, measured_at DESC);
CREATE INDEX idx_alerts_keyword_date
  ON alerts(keyword_id, triggered_at DESC);
```

### 4.3 API 통합

**1) SerpAPI (필수 - 핵심)**
```javascript
// 요청
GET https://serpapi.com/search
  ?engine=naver
  &q=호텔침대
  &api_key=YOUR_KEY
  &output=html

// 응답
{
  "raw_html": "<html>... 전체 SERP ...</html>"
}

// 처리
const html = response.raw_html
const block = parseSmartBlock(html)  // 자체 파싱
const rank = matchUrl(block.links, targetUrl)
```

**2) Naver Search API (선택 - 보조)**
```javascript
// 요청
GET https://openapi.naver.com/v1/search/blog.json
  ?query=호텔침대
  &display=20
Headers:
  X-Naver-Client-Id: YOUR_ID
  X-Naver-Client-Secret: YOUR_SECRET

// 응답
{
  "items": [
    { "link": "blog.naver.com/...", ... }
  ]
}

// 처리
const blogTabRank = findRankInList(items, targetUrl)
```

**3) Naver DataLab API (선택 - 분석)**
```javascript
// 요청 (주 1회)
POST https://openapi.naver.com/v1/datalab/search
Body: {
  "startDate": "2025-09-01",
  "endDate": "2025-10-01",
  "keywordGroups": [
    { "keywords": ["호텔침대"] }
  ]
}

// 응답
{
  "results": [{
    "data": [
      { "period": "2025-09-01", "ratio": 45.2 },
      ...
    ]
  }]
}

// 처리
const avgRatio = calculateAverage(data)
const trend = analyzeTrend(data)
```

---

## 🎨 5. 사용자 시나리오

### 시나리오 1: 신규 키워드 등록
```
1. 운영자가 대시보드 접속
2. "키워드 추가" 버튼 클릭
3. 폼 입력:
   - 키워드: "호텔침대"
   - URL: "https://blog.naver.com/myshop/987654"
4. "저장" 클릭
5. 시스템: 중복 체크 → DB 저장 → 다음날 오전 3시부터 측정 시작
```

### 시나리오 2: 순위 이탈 알림 및 대응
```
[매일 오전 3시 - 자동 측정]
1. 시스템: "호텔침대" 키워드 측정 시작
2. SerpAPI 호출 → HTML 수신
3. 파싱 엔진: 스마트블록 탐지 → 3개 링크 추출
4. 매칭: target_url이 없음 → rank = 0
5. 알림 조건 판정: 전일 3위 → 오늘 0위 (이탈)
6. Slack 알림 발송:
   "🚨 순위 이탈: 호텔침대 (3위→0위)"

[오전 9시 - 운영자 확인]
7. 운영자: Slack 알림 확인
8. 대시보드 접속 → 상세 화면
9. SERP 스냅샷 확인: 스마트블록 자체가 사라짐 (block_missing)
10. DataLab 추이 확인: 검색량 증가 중 📈
11. 의사결정: 새 글 재발행 필요
```

### 시나리오 3: 대시보드 모니터링
```
1. 운영자: 주간 리포트 작성 위해 대시보드 접속
2. 목록 화면: 키워드 100개 현황 한눈에 확인
3. 필터: "이탈만" 선택 → 5개 키워드 표시
4. "호텔침대" 클릭 → 상세 화면
5. 30일 그래프 확인:
   - 20일 전부터 3위 유지
   - 어제 갑자기 0위 이탈
6. 블로그 탭 순위: 7위 (여전히 노출 중)
7. 검색량: 최근 2주 급증 (재발행 적기)
8. CSV 내보내기 → 주간 리포트에 첨부
```

---

## 🚀 6. 구현 단계

### Phase 1: MVP (2주)
**목표**: 핵심 기능 PoC 검증

- [ ] SerpAPI 연동 (무료 티어 100회)
- [ ] 스마트블록 파싱 엔진 v1.0
- [ ] 키워드 3~5개 테스트
- [ ] PostgreSQL 스키마
- [ ] Slack 알림 (이탈만)
- [ ] 간단 CLI (대시보드 제외)

**인수 기준**:
- 키워드 5개 × 7일 측정 성공
- 스마트블록 탐지 정확도 > 80%
- 이탈 알림 정상 작동

**예산**: $0 (무료 티어)

---

### Phase 2: 베타 (1개월)
**목표**: 실운영 준비

- [ ] SerpAPI 유료 전환 ($50/월, 5,000회)
- [ ] 키워드 50~100개 확장
- [ ] Naver API 연동 (블로그 탭 + DataLab)
- [ ] 웹 대시보드 (목록 + 상세)
- [ ] 스케줄러 (BullMQ)
- [ ] 전체 알림 조건 구현
- [ ] 에러 핸들링 & 재시도

**인수 기준**:
- 키워드 100개 × 30일 안정 운영
- 측정 성공률 > 95%
- 대시보드 사용성 검증 (5명)

**예산**: $50~100/월

---

### Phase 3: 정식 출시 (2개월)
**목표**: 대량 처리 & 고도화

- [ ] 키워드 500~1,000개 확장
- [ ] 파싱 로직 고도화
  - 레이아웃 변경 자동 탐지
  - 다중 블록 유형 지원
- [ ] SMS 알림 추가
- [ ] CSV 일괄 업로드/관리
- [ ] 역할별 권한 관리 (RBAC)
- [ ] 모니터링 & 로깅 (Sentry + CloudWatch)

**인수 기준**:
- 키워드 1,000개 안정 운영
- 시스템 가용성 > 99%
- 레이아웃 변경 대응 < 24시간

**예산**: $100~250/월

---

## 📊 7. 성공 지표 (KPI)

### 운영 효율성
- **시간 절감**: 수동 확인 시간 3시간/일 → 0
- **키워드 커버리지**: 10개 → 1,000개 (100배)
- **대응 속도**: 이탈 발견 24시간 → 1시간 이내

### 기술 지표
- **측정 성공률**: > 95%
- **스마트블록 탐지 정확도**: > 90%
- **알림 지연 시간**: < 1분
- **시스템 가용성**: > 99%

### 비즈니스 지표
- **재발행 적중률**: 재발행 후 스마트블록 복귀율 > 70%
- **평균 순위 개선**: 30일 평균 순위 0.5위 향상
- **이탈 감소**: 연속 이탈 5일 이상 키워드 50% 감소

---

## 💰 8. 예산 및 비용

### 초기 개발 비용
- 개발 인력: 2명 × 3개월 = (인건비)
- SerpAPI 테스트: $0~50 (무료→유료 전환)
- 인프라 (AWS): $50/월 × 3개월 = $150
- **합계**: 개발비 + $200

### 월간 운영 비용 (정식 출시 기준)

| 항목 | 키워드 100개 | 키워드 500개 | 키워드 1,000개 |
|------|-------------|-------------|---------------|
| SerpAPI | $50 | $100 | $250 |
| AWS (EC2/RDS) | $30 | $50 | $100 |
| Naver API | $0 | $0 | $0 |
| SMS (선택) | $10 | $20 | $50 |
| **합계** | **$90** | **$170** | **$400** |

### 확장 시나리오별 ROI

**시나리오 A: 소규모 (100 키워드)**
- 월 비용: $90
- 절감 시간: 3시간/일 × 22일 = 66시간/월
- 시간당 인건비 $30 가정 → $1,980 절감
- **ROI: 2,100%**

**시나리오 B: 중규모 (500 키워드)**
- 월 비용: $170
- 절감 시간: 15시간/일 → 330시간/월
- 인건비 절감: $9,900
- **ROI: 5,700%**

---

## ⚠️ 9. 리스크 및 대응책

### R1: 네이버 레이아웃 변경
**확률**: 높음 (월 1회+)
**영향**: 중간 (파싱 실패)
**대응**:
- 자동 탐지 알림 (파싱 성공률 < 80% 시)
- 텍스트/구조 기반 탐지 (클래스명 의존 최소화)
- 핫픽스 프로세스 (24시간 내 수정)

### R2: SerpAPI 장애/비용 초과
**확률**: 낮음
**영향**: 높음 (측정 중단)
**대응**:
- 다중 벤더 준비 (DataForSEO 백업)
- 월간 쿼터 알림 (80% 도달 시)
- Playwright 폴백 (긴급)

### R3: 봇 탐지/IP 차단
**확률**: 낮음 (SerpAPI 사용 시)
**영향**: 중간
**대응**:
- SerpAPI 프록시 로테이션 활용
- 요청 빈도 제한 (1회/일)
- User-Agent 관리

### R4: 스마트블록 탐지 오류
**확률**: 중간
**영향**: 중간 (잘못된 순위)
**대응**:
- 스냅샷 저장 (HTML + 스크린샷)
- 사용자 피드백 수집
- 주간 정확도 리포트

---

## 🛠️ 10. 기술 스택

### 백엔드
- **언어**: Node.js 18+ (TypeScript)
- **프레임워크**: Express.js
- **ORM**: Prisma (TypeScript 친화적)

### 데이터베이스
- **메인**: PostgreSQL 14+
- **캐시/큐**: Redis 7+

### 작업 큐
- **BullMQ**: Redis 기반, 재시도/스케줄링

### 외부 API
- **SerpAPI**: Naver SERP HTML 수급
- **Naver Search API**: 블로그 탭 순위
- **Naver DataLab API**: 검색량 추이

### 프론트엔드
- **프레임워크**: React 18 (Next.js)
- **차트**: Chart.js 또는 Recharts
- **UI**: Tailwind CSS + shadcn/ui

### 인프라
- **클라우드**: AWS
  - EC2 (t3.small~medium)
  - Supabase Cloud (관리형 PostgreSQL)
  - ElastiCache Redis
  - S3 (스냅샷 저장)
- **모니터링**: CloudWatch + Sentry
- **CI/CD**: GitHub Actions

### 알림
- **Slack**: Webhook
- **SMS**: Twilio 또는 국내 게이트웨이
- **Email**: AWS SES

---

## 📚 11. 참고 문서

### 내부 문서
- [통화 기록](./참고/연태경대표이사(키워드솔루션)_01049420124_20251002160104.txt)
- [ChatGPT 분석](./참고/ChatGPT-네이버 API 활용 방법.md)
- [기술 분석 보고서](./temp/readonly/Claude's Plan.md)

### 외부 API 문서
- [SerpAPI - Naver Engine](https://serpapi.com/naver-search-api)
- [Naver Search API](https://developers.naver.com/docs/serviceapi/search/blog/blog.md)
- [Naver DataLab API](https://developers.naver.com/docs/serviceapi/datalab/search/search.md)

---

## ✅ 12. 승인 및 서명

| 역할 | 이름 | 서명 | 날짜 |
|------|------|------|------|
| Product Owner | 연태경 대표 | _______ | 2025-10-02 |
| 개발 리드 | | _______ | |
| 운영 리드 | | _______ | |

---

## 📝 13. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0.0 | 2025-10-02 | 개발팀 | 최초 작성 |

---

**문서 끝**
